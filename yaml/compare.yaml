          containers:
            - name: pytorch
              env:
                - name: PYTHONUNBUFFERED
                  value: "1"
                - name: FI_EFA_USE_DEVICE_RDMA
                  value: '1'
                - name: FI_PROVIDER
                  value: efa
                - name: NCCL_ASYNC_ERROR_HANDLING
                  value: '1'
                - name: NCCL_SOCKET_IFNAME
                  value: eth0
                - name: GLOO_SOCKET_IFNAME
                  value: eth0
                - name: NCCL_PROTO
                  value: simple
                - name: NCCL_PXN_DISABLE
                  value: '0'
                - name: FI_LOG_LEVEL
                  value: warn
                - name: NCCL_AVOID_RECORD_STREAMS
                  value: '1'
                - name: NCCL_P2P_LEVEL
                  value: NVL
                - name: NCCL_DEBUG
                  value: TRACE
                - name: TORCH_NCCL_AVOID_RECORD_STREAMS
                  value: '1'
                - name: NCCL_IGNORE_DISABLED_P2P
                  value: '0'
                - name: REGION
                  value: "us-east-1"
              command: ["bash","-c"]
              # ipv6 needs to be disabled otherwise rdvz comm breaks
              args:
                -  >- 
                  sysctl -w net.ipv6.conf.all.disable_ipv6=1 && 
                  sysctl -w net.ipv6.conf.default.disable_ipv6=1 && 
                  export PATH=/opt/amazon/efa/bin:$PATH &&
                  export LD_LIBRARY_PATH=/opt/amazon/efa/lib:$LD_LIBRARY_PATH &&
                  export LD_LIBRARY_PATH=/opt/amazon/ofi-nccl/lib/x86_64-linux-gnu:/opt/amazon/ofi-nccl/lib:/opt/aws-ofi-nccl/lib:$LD_LIBRARY_PATH &&
                  export NCCL_ASYNC_ERROR_HANDLING=1 &&
                  export NCCL_BLOCKING_WAIT=1 &&
                  export NCCL_DEBUG=INFO &&
                  export NCCL_DEBUG_SUBSYS=INIT,NET,ENV &&
                  export OMP_NUM_THREADS=64 &&
                  export OLMO_SHARED_FS=1 &&
                  export NCCL_NET=OFI &&
                  export FI_PROVIDER=efa &&
                  export FI_EFA_ENABLE_SHM_TRANSFER=1 &&
                  export NCCL_IB_DISABLE=1  &&
                  ulimit -l unlimited &&
                  unset NCCL_SOCKET_IFNAME &&
                  export WANDB_API_KEY="3148f05a33b5a05ae2212a36782219cc5eaf9ce5" &&
                  WANDB_DIR=./wandb_logs &&
                  export WANDB_DIR &&
                  export WANDB_MODE=offline &&
                  sleep infinity
              image: 767397878797.dkr.ecr.us-east-1.amazonaws.com/agif-mm-pt-base:reasoning-vllm.sglang.megatron.deepseek.video.fa3
              imagePullPolicy: IfNotPresent
              securityContext:
                privileged: true
              resources:
                limits:
                  hugepages-2Mi: 5120Mi
                  vpc.amazonaws.com/efa: 16
                  nvidia.com/gpu: *gpus_per_node
                requests:
                  nvidia.com/gpu: *gpus_per_node
                  vpc.amazonaws.com/efa: 16
                  memory: 64000Mi
              volumeMounts:
                - mountPath: /data-fsx
                  name: fsx-claim-general--atl-2a2
                - mountPath: /code-fsx
                  name: fsx-claim-general--atl-2a1
                - mountPath: /checkpoint-fsx
                  name: fsx-claim-general--atl-2a3
                - mountPath: /dev/shm
                  name: dshm
                - mountPath: /dev/infiniband/uverbs0
                  name: infiniband-efa-0
                - mountPath: /dev/infiniband/uverbs1
                  name: infiniband-efa-1
                - mountPath: /dev/infiniband/uverbs2
                  name: infiniband-efa-2
                - mountPath: /dev/infiniband/uverbs3
                  name: infiniband-efa-3
                - mountPath: /dev/infiniband/uverbs4
                  name: infiniband-efa-4
                - mountPath: /dev/infiniband/uverbs5
                  name: infiniband-efa-5
                - mountPath: /dev/infiniband/uverbs6
                  name: infiniband-efa-6
                - mountPath: /dev/infiniband/uverbs7
                  name: infiniband-efa-7
                - mountPath: /dev/infiniband/uverbs8
                  name: infiniband-efa-8
                - mountPath: /dev/infiniband/uverbs9
                  name: infiniband-efa-9
                - mountPath: /dev/infiniband/uverbs10
                  name: infiniband-efa-10
                - mountPath: /dev/infiniband/uverbs11
                  name: infiniband-efa-11
                - mountPath: /dev/infiniband/uverbs12
                  name: infiniband-efa-12
                - mountPath: /dev/infiniband/uverbs13
                  name: infiniband-efa-13
                - mountPath: /dev/infiniband/uverbs14
                  name: infiniband-efa-14
                - mountPath: /dev/infiniband/uverbs15
                  name: infiniband-efa-15
          volumes:
            - name: fsx-claim-general--atl-2a1
              persistentVolumeClaim:
                claimName: fsx-claim-general-a1
            - name: fsx-claim-general--atl-2a2
              persistentVolumeClaim:
                claimName: fsx-claim-general-a4
            - name: fsx-claim-general--atl-2a3
              persistentVolumeClaim:
                claimName: fsx-claim-general-a3
            - name: infiniband-efa-0
              hostPath:
                path: /dev/infiniband/uverbs0
            - name: infiniband-efa-1
              hostPath:
                path: /dev/infiniband/uverbs1
            - name: infiniband-efa-2
              hostPath:
                path: /dev/infiniband/uverbs2
            - name: infiniband-efa-3
              hostPath:
                path: /dev/infiniband/uverbs3
            - name: infiniband-efa-4
              hostPath:
                path: /dev/infiniband/uverbs4
            - name: infiniband-efa-5
              hostPath:
                path: /dev/infiniband/uverbs5
            - name: infiniband-efa-6
              hostPath:
                path: /dev/infiniband/uverbs6
            - name: infiniband-efa-7
              hostPath:
                path: /dev/infiniband/uverbs7
            - name: infiniband-efa-8
              hostPath:
                path: /dev/infiniband/uverbs8
            - name: infiniband-efa-9
              hostPath:
                path: /dev/infiniband/uverbs9
            - name: infiniband-efa-10
              hostPath:
                path: /dev/infiniband/uverbs10
            - name: infiniband-efa-11
              hostPath:
                path: /dev/infiniband/uverbs11
            - name: infiniband-efa-12
              hostPath:
                path: /dev/infiniband/uverbs12
            - name: infiniband-efa-13
              hostPath:
                path: /dev/infiniband/uverbs13
            - name: infiniband-efa-14
              hostPath:
                path: /dev/infiniband/uverbs14
            - name: infiniband-efa-15
              hostPath:
                path: /dev/infiniband/uverbs15
            - name: dshm
              emptyDir: 
                medium: Memory
                sizeLimit: 500Gi